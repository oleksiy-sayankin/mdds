/*
 * Copyright (c) 2025 Oleksiy Oleksandrovych Sayankin. All Rights Reserved.
 * Refer to the LICENSE file in the root directory for full license details.
 */
syntax = "proto3";

import "google/protobuf/timestamp.proto";

package solver;

option java_package = "com.mdds.grpc.solver";
option java_multiple_files = true;

// gRPC service for solving system of linear equations.
service SolverService {
  rpc SubmitTask(SubmitTaskRequest) returns (SubmitTaskResponse);
  rpc GetTaskStatus(GetTaskStatusRequest) returns (GetTaskStatusResponse);
  rpc CancelTask(CancelTaskRequest) returns (CancelTaskResponse);
}

// Request for solving SLAE
message SubmitTaskRequest {
  string taskId = 1;            // unique task id
  string method = 2;            // method name (e.g: "numpy_exact_solver")
  repeated Row matrix = 3;      // matrix A
  repeated double rhs = 4;      // right hand side b

}

// Request for getting task status
message GetTaskStatusRequest {
  string taskId = 1;
}

// Request for cancelling of running solving process for SLAE
message CancelTaskRequest {
  string taskId = 1;
}

enum TaskStatus {
  UNKNOWN = 0;
  NEW = 1;
  DONE = 2;
  ERROR = 3;
  CANCELLED = 4;
  IN_PROGRESS = 5;
}

enum RequestStatus {
  UNSPECIFIED = 0;
  COMPLETED = 1;
  DECLINED = 2;
}

message CancelTaskResponse {
  string taskId = 1;
  RequestStatus requestStatus = 2;
  string requestStatusDetails = 3;
}

// Solution
message GetTaskStatusResponse {
  string taskId = 1;
  RequestStatus requestStatus = 2;
  string requestStatusDetails = 3;
  google.protobuf.Timestamp startTime = 4;
  google.protobuf.Timestamp endTime = 5;
  TaskStatus taskStatus = 6;
  int32 progress = 7;
  string taskMessage = 8;
  repeated double solution = 9; // solution of SLAE
}

// Matrix for SLAE as repeated row
message Row {
  repeated double values = 1;
}

message SubmitTaskResponse {
  string taskId = 1;
  RequestStatus requestStatus = 2;
  string requestStatusDetails = 3;
}
