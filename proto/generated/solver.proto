/*
 * Copyright (c) 2025 Oleksiy Oleksandrovych Sayankin. All Rights Reserved.
 * Refer to the LICENSE file in the root directory for full license details.
 */
syntax = "proto3";

import "google/protobuf/timestamp.proto";

package solver;

option java_package = "com.mdds.grpc.solver";
option java_multiple_files = true;

// gRPC service for solving system of linear equations.
service SolverService {
  rpc SubmitJob(SubmitJobRequest) returns (SubmitJobResponse);
  rpc GetJobStatus(GetJobStatusRequest) returns (GetJobStatusResponse);
  rpc CancelJob(CancelJobRequest) returns (CancelJobResponse);
}

// Request for solving SLAE
message SubmitJobRequest {
  string jobId = 1;             // unique job id
  string method = 2;            // method name (e.g: "numpy_exact_solver")
  repeated Row matrix = 3;      // matrix A
  repeated double rhs = 4;      // right hand side b

}

// Request for getting job status
message GetJobStatusRequest {
  string jobId = 1;
}

// Request for cancelling of running solving process for SLAE
message CancelJobRequest {
  string jobId = 1;
}

enum JobStatus {
  UNKNOWN = 0;
  NEW = 1;
  DONE = 2;
  ERROR = 3;
  CANCELLED = 4;
  IN_PROGRESS = 5;
}

enum RequestStatus {
  UNSPECIFIED = 0;
  COMPLETED = 1;
  DECLINED = 2;
}

message CancelJobResponse {
  string jobId = 1;
  RequestStatus requestStatus = 2;
  string requestStatusDetails = 3;
}

// Solution
message GetJobStatusResponse {
  string jobId = 1;
  RequestStatus requestStatus = 2;
  string requestStatusDetails = 3;
  google.protobuf.Timestamp startTime = 4;
  google.protobuf.Timestamp endTime = 5;
  JobStatus jobStatus = 6;
  int32 progress = 7;
  string jobMessage = 8;
  repeated double solution = 9; // solution of SLAE
}

// Matrix for SLAE as repeated row
message Row {
  repeated double values = 1;
}

message SubmitJobResponse {
  string jobId = 1;
  RequestStatus requestStatus = 2;
  string requestStatusDetails = 3;
}
